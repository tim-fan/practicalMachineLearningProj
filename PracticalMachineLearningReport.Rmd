---
title: "Practical Machine Learning Report"
author: "Tim F"
date: "17 March 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```

## Executive Summary
To Do

## Exploratory Analysis
``` {r setup}
library(parallel)
library(doParallel)
library(caret)
set.seed(300)
```


Fetch the training and test data:

```{r download}
trainingDataUrl = 'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv'
testDataUrl = 'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv'

trainingDataFilename = 'data/pml-training.csv'
testDataFilename = 'data/pml-testing.csv'
dir.create('data', showWarnings = FALSE)
download.file(trainingDataUrl, destfile = trainingDataFilename)
download.file(testDataUrl, destfile = testDataFilename)

readData <- function(filename) {read.csv(filename, header = T, sep = ',', na.strings = c("", "NA"))}

trainingData <- readData(trainingDataFilename)
testData <- readData(testDataFilename)
```

A detailed description of the dataset is available here:
http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har


```{r explore}
names(trainingData)
```

```{r explore2}
head(trainingData)
```

Note - some rows represent instantaneous IMU readings (rows where new_window = no), while some rows additionally include features computed over a sliding window (rows where new_window = yes).
The majority of the columns represent these computed features.
The test data only contains the instantaneous data, not any of the computed features. I take this to mean that our model should only be trained on the instantaneous values.

Hence all columns containing NAN values will be dropped (assuming the computed features are the only coluns containing NANs)

```{r dropNan}
trainingData <- trainingData[,!apply(trainingData,FUN = anyNA, MARGIN = 2)]
```

Also drop a few more variables that shouldn't be used for prediction - timestamps, window info.

Will keep the user_name variable, although perhaps we shouldn't be fitting to specific users.

```{r dropTimestamps}
trainingData <- subset(trainingData, select=-c(X,raw_timestamp_part_1, raw_timestamp_part_2, cvtd_timestamp, new_window, num_window))
str(trainingData)
```


```{r training}

#set up for multi-core training
cluster <- makeCluster(detectCores() - 1)
registerDoParallel(cluster)

fitControl <- trainControl(method = "cv",
                           number = 5,
                           allowParallel = TRUE)

#fit <- train(classe ~ ., trainingData, method="rf", trControl = fitControl)
#while messing around, just use a subset of data for quicker training
adelmoData <- subset(trainingData, user_name == 'adelmo')
```
